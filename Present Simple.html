<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 6B – He speaks English at work</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: #fff;
        }

        .header { text-align: center; padding: 28px 20px 8px; }
        .header h1 {
            font-size: 2.2rem; font-weight: 800;
            background: linear-gradient(90deg, #00c9ff, #92fe9d);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .header p { font-size: .95rem; color: #b8b8d0; margin-top: 4px; }

        .tab-bar { display: flex; justify-content: center; gap: 10px; margin: 18px auto 28px; flex-wrap: wrap; padding: 0 12px; }
        .tab-btn {
            padding: 10px 22px; border: 2px solid rgba(255,255,255,.12); border-radius: 50px;
            background: rgba(255,255,255,.05); color: #aaa; font-family: inherit;
            font-size: .88rem; font-weight: 700; cursor: pointer; transition: all .3s; white-space: nowrap;
        }
        .tab-btn:hover { background: rgba(255,255,255,.1); color: #fff; }
        .tab-btn.active {
            background: linear-gradient(135deg, #00c9ff, #92fe9d); color: #1a1a2e;
            border-color: transparent; box-shadow: 0 4px 18px rgba(0,201,255,.3);
        }

        .section { display: none; max-width: 780px; margin: 0 auto; padding: 0 18px 50px; }
        .section.active { display: block; }

        .card {
            background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.1);
            border-radius: 20px; padding: 28px 30px; margin-bottom: 24px;
            backdrop-filter: blur(8px);
        }
        .card h2 {
            font-size: 1.35rem; font-weight: 800; margin-bottom: 16px;
            background: linear-gradient(90deg, #00c9ff, #92fe9d);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .card h3 { font-size: 1.1rem; font-weight: 700; color: #92fe9d; margin: 18px 0 10px; }

        .rule-table { width: 100%; border-collapse: collapse; margin: 14px 0; }
        .rule-table th {
            background: rgba(0,201,255,.15); color: #00c9ff; padding: 12px 14px;
            text-align: left; font-size: .95rem; border-bottom: 2px solid rgba(0,201,255,.25);
        }
        .rule-table td {
            padding: 10px 14px; border-bottom: 1px solid rgba(255,255,255,.06);
            color: #d8d8e8; font-size: .95rem; line-height: 1.5;
        }
        .rule-table tr:hover td { background: rgba(255,255,255,.03); }
        .rule-table .highlight { color: #92fe9d; font-weight: 700; }
        .rule-table .example { color: #aaa; font-style: italic; font-size: .88rem; }

        .tip-box {
            background: rgba(146,254,157,.08); border-left: 4px solid #92fe9d;
            padding: 14px 18px; border-radius: 0 12px 12px 0; margin: 16px 0;
            color: #c0f0c8; font-size: .95rem; line-height: 1.6;
        }
        .tip-box strong { color: #92fe9d; }

        .exercise-item {
            background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08);
            border-radius: 14px; padding: 16px 20px; margin-bottom: 12px;
            cursor: pointer; transition: all .3s; user-select: none;
        }
        .exercise-item:hover { border-color: rgba(0,201,255,.3); background: rgba(255,255,255,.07); }
        .exercise-item.revealed { border-color: rgba(146,254,157,.35); background: rgba(146,254,157,.05); }
        .exercise-item .q-text { font-size: 1.05rem; color: #e0e0f0; line-height: 1.6; }
        .exercise-item .q-num {
            display: inline-flex; align-items: center; justify-content: center;
            width: 26px; height: 26px; background: rgba(0,201,255,.15);
            color: #00c9ff; border-radius: 50%; font-size: .8rem; font-weight: 800;
            margin-right: 8px; flex-shrink: 0;
        }
        .exercise-item .blank {
            display: inline-block; min-width: 110px; border-bottom: 2px dashed #00c9ff;
            text-align: center; color: #92fe9d; font-weight: 800; transition: all .3s;
            margin: 0 3px; padding: 0 6px;
        }
        .exercise-item .blank.show { border-bottom-style: solid; background: rgba(146,254,157,.1); border-radius: 4px; }
        .exercise-item .hint { font-size: .78rem; color: #666; margin-top: 6px; }

        /* ── Audio wrapper ── */
        .audio-wrapper {
            display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
            background: rgba(0,201,255,.08); border: 1px solid rgba(0,201,255,.2);
            border-radius: 14px; padding: 14px 18px; margin: 16px 0;
        }
        .audio-wrapper .audio-icon { font-size: 1.6rem; flex-shrink: 0; }
        .audio-wrapper audio { flex: 1; min-width: 200px; height: 40px; border-radius: 8px; }
        .audio-label { font-size: .85rem; color: #00c9ff; font-weight: 700; flex-shrink: 0; }

        /* ── File loader ── */
        .file-loader-zone {
            display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
            background: rgba(0,201,255,.06); border: 2px dashed rgba(0,201,255,.25);
            border-radius: 14px; padding: 16px 20px; margin: 16px 0;
            transition: all .3s;
        }
        .file-loader-zone.loaded {
            border-style: solid; border-color: rgba(146,254,157,.3);
            background: rgba(146,254,157,.05);
        }
        .file-loader-zone .audio-icon { font-size: 1.5rem; flex-shrink: 0; }
        .file-loader-zone .file-info { flex: 1; min-width: 0; }
        .file-loader-zone .file-label { font-size: .95rem; color: #00c9ff; font-weight: 700; }
        .file-loader-zone .file-hint { font-size: .8rem; color: #777; margin-top: 2px; }
        .file-loader-zone .file-status { font-size: .82rem; color: #92fe9d; margin-top: 4px; display: none; }
        .file-loader-zone.loaded .file-status { display: block; }
        .file-loader-zone.loaded .file-hint { display: none; }

        .load-btn {
            padding: 8px 20px; border: 2px solid #00c9ff; background: transparent;
            color: #00c9ff; border-radius: 50px; font-family: inherit;
            font-size: .85rem; font-weight: 700; cursor: pointer; transition: all .3s;
            flex-shrink: 0;
        }
        .load-btn:hover { background: #00c9ff; color: #1a1a2e; }
        .file-loader-zone.loaded .load-btn { border-color: #92fe9d; color: #92fe9d; }
        .file-loader-zone.loaded .load-btn:hover { background: #92fe9d; color: #1a1a2e; }

        .audio-player-row {
            display: none; align-items: center; gap: 14px;
            background: rgba(146,254,157,.06); border: 1px solid rgba(146,254,157,.2);
            border-radius: 14px; padding: 14px 18px; margin: 8px 0 16px;
        }
        .audio-player-row.visible { display: flex; }
        .audio-player-row audio { flex: 1; min-width: 200px; height: 42px; border-radius: 8px; }
        .audio-player-row .audio-icon { font-size: 1.5rem; }

        /* ── Dialogue ── */
        .dialogue-box {
            background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.08);
            border-radius: 16px; padding: 22px 24px; margin: 16px 0;
        }
        .dialogue-line { margin-bottom: 10px; line-height: 1.7; font-size: 1rem; color: #d8d8e8; }
        .dialogue-line .speaker { color: #00c9ff; font-weight: 800; margin-right: 6px; }
        .dialogue-line .gap {
            display: inline-block; min-width: 90px; border-bottom: 2px dashed #92fe9d;
            text-align: center; color: #92fe9d; font-weight: 800; cursor: pointer;
            transition: all .3s; margin: 0 2px; padding: 0 4px;
        }
        .dialogue-line .gap.show { border-bottom-style: solid; background: rgba(146,254,157,.1); border-radius: 4px; }

        .action-btn {
            padding: 10px 28px; border: 2px solid #00c9ff; background: transparent;
            color: #00c9ff; border-radius: 50px; font-family: inherit;
            font-size: .92rem; font-weight: 700; cursor: pointer; transition: all .3s; margin: 6px 4px;
        }
        .action-btn:hover { background: #00c9ff; color: #1a1a2e; }
        .action-btn.green { border-color: #92fe9d; color: #92fe9d; }
        .action-btn.green:hover { background: #92fe9d; color: #1a1a2e; }
        .btn-row { text-align: center; margin-top: 18px; }

        .pron-s { color: #00c9ff; font-weight: 700; }
        .pron-z { color: #92fe9d; font-weight: 700; }
        .pron-iz { color: #ffd200; font-weight: 700; }

        .transform-grid { display: grid; gap: 12px; }
        .transform-card {
            background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08);
            border-radius: 14px; padding: 16px 20px; cursor: pointer;
            transition: all .3s; user-select: none;
        }
        .transform-card:hover { border-color: rgba(0,201,255,.3); background: rgba(255,255,255,.07); }
        .transform-card.revealed { border-color: rgba(146,254,157,.35); background: rgba(146,254,157,.05); }
        .transform-card .original { color: #d8d8e8; font-size: 1rem; margin-bottom: 6px; }
        .transform-card .arrow { color: #00c9ff; font-size: .85rem; margin-bottom: 4px; }
        .transform-card .answer-line {
            min-height: 28px; border-bottom: 2px dashed rgba(146,254,157,.3);
            color: #92fe9d; font-weight: 700; font-size: 1rem; transition: all .3s;
        }
        .transform-card .answer-line.show { border-bottom-style: solid; }
        .transform-card .t-hint { font-size: .75rem; color: #555; margin-top: 4px; }
        .transform-card .t-num {
            display: inline-flex; align-items: center; justify-content: center;
            width: 24px; height: 24px; background: rgba(0,201,255,.15);
            color: #00c9ff; border-radius: 50%; font-size: .78rem; font-weight: 800;
            margin-right: 8px;
        }

        /* Hidden file input */
        .hidden-input { display: none; }

        @media (max-width: 520px) {
            .header h1 { font-size: 1.5rem; }
            .card { padding: 20px 18px; }
            .tab-btn { padding: 8px 16px; font-size: .8rem; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Unit 6B — He speaks English at work</h1>
    <p>Present Simple: he / she / it &nbsp;|&nbsp; Adding -s / -es / -ies</p>
</div>

<div class="tab-bar">
    <button class="tab-btn active" data-tab="rules">1. Grammar Rules</button>
    <button class="tab-btn" data-tab="practice">2. Practice</button>
    <button class="tab-btn" data-tab="transform">3. I → He/She</button>
    <button class="tab-btn" data-tab="pronunciation">4. Pronunciation</button>
    <button class="tab-btn" data-tab="dialogue">5. Listening</button>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!--           SECTION 1 — GRAMMAR RULES            -->
<!-- ═══════════════════════════════════════════════ -->
<div id="section-rules" class="section active">
    <div class="card">
        <h2>Present Simple: he / she / it</h2>
        <p style="color:#b8b8d0; margin-bottom:14px;">
            When we talk about another person (he, she) or a thing (it), we add <strong style="color:#92fe9d">-s</strong>, <strong style="color:#92fe9d">-es</strong>, or <strong style="color:#92fe9d">-ies</strong> to the verb.
        </p>

        <h3>Rule 1 — Most verbs: add -s</h3>
        <table class="rule-table">
            <tr><th>I / you / we / they</th><th>he / she / it</th></tr>
            <tr><td>I <span class="highlight">work</span> in a hospital.</td><td>He <span class="highlight">works</span> in a hospital.</td></tr>
            <tr><td>They <span class="highlight">live</span> in London.</td><td>She <span class="highlight">lives</span> in London.</td></tr>
            <tr><td>We <span class="highlight">speak</span> English.</td><td>He <span class="highlight">speaks</span> English.</td></tr>
        </table>
        <div class="tip-box">
            <strong>Tip:</strong> Most verbs just take <strong>-s</strong>. Think: work → work<strong>s</strong>, eat → eat<strong>s</strong>, read → read<strong>s</strong>, play → play<strong>s</strong>.
        </div>

        <h3>Rule 2 — Verbs ending in -ch, -sh, -ss, -x, -o: add -es</h3>
        <table class="rule-table">
            <tr><th>Ending</th><th>I / you / we / they</th><th>he / she / it</th></tr>
            <tr><td>-ch</td><td>I <span class="highlight">teach</span></td><td>She <span class="highlight">teaches</span></td></tr>
            <tr><td>-sh</td><td>I <span class="highlight">wash</span></td><td>He <span class="highlight">washes</span></td></tr>
            <tr><td>-ss</td><td>We <span class="highlight">miss</span></td><td>She <span class="highlight">misses</span></td></tr>
            <tr><td>-x</td><td>They <span class="highlight">fix</span></td><td>He <span class="highlight">fixes</span></td></tr>
            <tr><td>-o</td><td>I <span class="highlight">go</span></td><td>She <span class="highlight">goes</span></td></tr>
        </table>
        <div class="tip-box">
            <strong>Why -es?</strong> Because these words already end with a "hissing" sound. Adding just <strong>-s</strong> would be hard to hear, so we add <strong>-es</strong> to make it clear.
        </div>

        <h3>Rule 3 — Verbs ending in consonant + y: change y → ies</h3>
        <table class="rule-table">
            <tr><th>I / you / we / they</th><th>he / she / it</th><th>Why?</th></tr>
            <tr><td>I <span class="highlight">study</span></td><td>She <span class="highlight">studies</span></td><td><span class="example">consonant (d) + y → ies</span></td></tr>
            <tr><td>We <span class="highlight">carry</span></td><td>He <span class="highlight">carries</span></td><td><span class="example">consonant (r) + y → ies</span></td></tr>
            <tr><td>They <span class="highlight">try</span></td><td>It <span class="highlight">tries</span></td><td><span class="example">consonant (r) + y → ies</span></td></tr>
        </table>
        <div class="tip-box">
            <strong>Be careful!</strong> If the letter before <strong>-y</strong> is a <strong>vowel</strong> (a, e, i, o, u), just add <strong>-s</strong> normally:
            play → play<strong>s</strong>, enjoy → enjoy<strong>s</strong>, buy → buy<strong>s</strong>.
        </div>

        <h3>Irregular: have → has</h3>
        <table class="rule-table">
            <tr><th>I / you / we / they</th><th>he / she / it</th></tr>
            <tr><td>I <span class="highlight">have</span> a car.</td><td>She <span class="highlight">has</span> a car.</td></tr>
        </table>

        <h3>Quick Summary</h3>
        <table class="rule-table">
            <tr><th>Rule</th><th>Add</th><th>Examples</th></tr>
            <tr><td>Most verbs</td><td class="highlight">-s</td><td class="example">works, eats, lives, reads, plays</td></tr>
            <tr><td>-ch, -sh, -ss, -x, -o</td><td class="highlight">-es</td><td class="example">teaches, washes, misses, fixes, goes</td></tr>
            <tr><td>consonant + y</td><td class="highlight">-ies</td><td class="example">studies, carries, tries, flies</td></tr>
            <tr><td>vowel + y</td><td class="highlight">-s</td><td class="example">plays, enjoys, buys, says</td></tr>
            <tr><td>have</td><td class="highlight">has</td><td class="example">She has two children.</td></tr>
        </table>
    </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!--           SECTION 2 — PRACTICE                 -->
<!-- ═══════════════════════════════════════════════ -->
<div id="section-practice" class="section">
    <div class="card">
        <h2>Exercise: Write the correct form</h2>
        <p style="color:#b8b8d0; margin-bottom:16px;">Click each sentence to show or hide the answer.</p>
        <div id="practice-container"></div>
        <div class="btn-row">
            <button class="action-btn" onclick="toggleAllPractice(true)">Show All</button>
            <button class="action-btn green" onclick="toggleAllPractice(false)">Hide All</button>
        </div>
    </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!--           SECTION 3 — TRANSFORM                -->
<!-- ═══════════════════════════════════════════════ -->
<div id="section-transform" class="section">
    <div class="card">
        <h2>3b. Change "I" to "He" or "She"</h2>
        <p style="color:#b8b8d0; margin-bottom:16px;">Read each sentence with "I". Click to reveal the same sentence with "He" or "She". Remember to change the verb!</p>
        <div class="transform-grid" id="transform-container"></div>
        <div class="btn-row">
            <button class="action-btn" onclick="toggleAllTransform(true)">Show All</button>
            <button class="action-btn green" onclick="toggleAllTransform(false)">Hide All</button>
        </div>
    </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!--           SECTION 4 — PRONUNCIATION            -->
<!-- ═══════════════════════════════════════════════ -->
<div id="section-pronunciation" class="section">
    <div class="card">
        <h2>3a. Pronunciation of -s / -es</h2>
        <p style="color:#b8b8d0; margin-bottom:10px;">
            The <strong style="color:#92fe9d">-s / -es</strong> ending has <strong>three different sounds</strong>. Load the audio file, listen, then click each word to check the pronunciation group.
        </p>

        <!-- Audio file loader for 6.06 -->
        <div class="file-loader-zone" id="zone-606">
            <span class="audio-icon">&#127925;</span>
            <div class="file-info">
                <div class="file-label">Audio 6.06 — Pronunciation of -s endings</div>
                <div class="file-hint">Click "Load" and select <strong>EF_4e_Beginner_SB_6.06.mp3</strong> from your computer</div>
                <div class="file-status">&#10003; Audio loaded — press play below!</div>
            </div>
            <button class="load-btn" onclick="document.getElementById('file-606').click()">Load Audio</button>
            <input type="file" id="file-606" class="hidden-input" accept="audio/*" onchange="loadAudio(this, 'player-606', 'zone-606')">
        </div>
        <div class="audio-player-row" id="player-606">
            <span class="audio-icon">&#9654;&#65039;</span>
            <audio controls id="audio-606"></audio>
        </div>

        <h3>The Three Sounds</h3>
        <table class="rule-table">
            <tr>
                <th><span class="pron-s">/s/</span></th>
                <th><span class="pron-z">/z/</span></th>
                <th><span class="pron-iz">/ɪz/</span></th>
            </tr>
            <tr>
                <td>After voiceless sounds:<br><span class="example">p, t, k, f, θ</span></td>
                <td>After voiced sounds:<br><span class="example">b, d, g, v, m, n, l, r + vowels</span></td>
                <td>After "hissing" sounds:<br><span class="example">s, z, ʃ, ʒ, tʃ, dʒ</span></td>
            </tr>
        </table>

        <h3>Sort the words — Click to reveal</h3>
        <div id="pron-container"></div>
        <div class="btn-row">
            <button class="action-btn" onclick="toggleAllPron(true)">Show All</button>
            <button class="action-btn green" onclick="toggleAllPron(false)">Hide All</button>
        </div>
    </div>
</div>

<!-- ═══════════════════════════════════════════════ -->
<!--           SECTION 5 — LISTENING DIALOGUE       -->
<!-- ═══════════════════════════════════════════════ -->
<div id="section-dialogue" class="section">
    <div class="card">
        <h2>Listening: Emily and Sofia</h2>
        <p style="color:#b8b8d0; margin-bottom:10px;">
            Load the audio, listen to the dialogue, and fill in the <strong style="color:#92fe9d">14 gaps</strong>. Click each gap to check your answer. Click again to hide it.
        </p>

        <!-- Audio file loader for 6.04 -->
        <div class="file-loader-zone" id="zone-604">
            <span class="audio-icon">&#127911;</span>
            <div class="file-info">
                <div class="file-label">Audio 6.04 — Dialogue: Emily and Sofia</div>
                <div class="file-hint">Click "Load" and select <strong>EF_4e_Beginner_SB_6.04.mp3</strong> from your computer</div>
                <div class="file-status">&#10003; Audio loaded — press play below!</div>
            </div>
            <button class="load-btn" onclick="document.getElementById('file-604').click()">Load Audio</button>
            <input type="file" id="file-604" class="hidden-input" accept="audio/*" onchange="loadAudio(this, 'player-604', 'zone-604')">
        </div>
        <div class="audio-player-row" id="player-604">
            <span class="audio-icon">&#9654;&#65039;</span>
            <audio controls id="audio-604"></audio>
        </div>

        <div class="dialogue-box" id="dialogue-box"></div>

        <div class="btn-row">
            <button class="action-btn" onclick="toggleAllGaps(true)">Show All Answers</button>
            <button class="action-btn green" onclick="toggleAllGaps(false)">Hide All Answers</button>
        </div>
    </div>
</div>

<script>
/* ══════════════════════════════════════════
        AUDIO FILE LOADER
   ══════════════════════════════════════════ */
function loadAudio(input, playerRowId, zoneId) {
    const file = input.files[0];
    if (!file) return;
    const playerRow = document.getElementById(playerRowId);
    const audioEl = playerRow.querySelector('audio');
    const zone = document.getElementById(zoneId);

    // Create object URL from the local file
    const url = URL.createObjectURL(file);
    audioEl.src = url;
    audioEl.load();

    // Show the player and update the zone
    playerRow.classList.add('visible');
    zone.classList.add('loaded');
}

/* ══════════════════════════════════════════
        TABS
   ══════════════════════════════════════════ */
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function(){
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('section-' + this.dataset.tab).classList.add('active');
        this.classList.add('active');
        window.scrollTo({top: 0, behavior: 'smooth'});
    });
});

/* ══════════════════════════════════════════
        PRACTICE DATA
   ══════════════════════════════════════════ */
const practiceData = [
    { q: 'She _______ (work) in a hospital.', a: 'works' },
    { q: 'He _______ (teach) English and French.', a: 'teaches' },
    { q: 'She _______ (study) at university.', a: 'studies' },
    { q: 'He _______ (live) in Madrid.', a: 'lives' },
    { q: 'She _______ (go) to work by bus.', a: 'goes' },
    { q: 'He _______ (have) two children.', a: 'has' },
    { q: 'She _______ (watch) TV in the evening.', a: 'watches' },
    { q: 'It _______ (finish) at six o\'clock.', a: 'finishes' },
    { q: 'He _______ (play) football on Saturdays.', a: 'plays' },
    { q: 'She _______ (speak) three languages.', a: 'speaks' },
    { q: 'He _______ (wash) the car every Sunday.', a: 'washes' },
    { q: 'She _______ (carry) a big bag to work.', a: 'carries' },
    { q: 'He _______ (eat) lunch at one o\'clock.', a: 'eats' },
    { q: 'She _______ (try) to learn new words every day.', a: 'tries' },
    { q: 'He _______ (fix) computers.', a: 'fixes' },
    { q: 'She _______ (read) the newspaper in the morning.', a: 'reads' },
    { q: 'He _______ (miss) his family.', a: 'misses' },
    { q: 'She _______ (enjoy) her job very much.', a: 'enjoys' },
    { q: 'He _______ (fly) to New York every month.', a: 'flies' },
    { q: 'She _______ (do) her homework after dinner.', a: 'does' },
];

function buildPractice() {
    const c = document.getElementById('practice-container');
    c.innerHTML = '';
    const ph = '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0';
    practiceData.forEach((item, i) => {
        const parts = item.q.split('_______');
        const div = document.createElement('div');
        div.className = 'exercise-item';
        div.innerHTML = `
            <div class="q-text"><span class="q-num">${i+1}</span>${parts[0]}<span class="blank" data-a="${item.a}">${ph}</span>${parts[1]||''}</div>
            <div class="hint">Click to show / hide</div>
        `;
        div.addEventListener('click', function(){
            const blank = this.querySelector('.blank');
            if (this.classList.contains('revealed')) {
                this.classList.remove('revealed'); blank.classList.remove('show');
                blank.textContent = ph; this.querySelector('.hint').textContent = 'Click to show the answer';
            } else {
                this.classList.add('revealed'); blank.classList.add('show');
                blank.textContent = blank.dataset.a; this.querySelector('.hint').textContent = 'Click to hide the answer';
            }
        });
        c.appendChild(div);
    });
}
function toggleAllPractice(show) {
    const ph = '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0';
    document.querySelectorAll('#practice-container .exercise-item').forEach(item => {
        const blank = item.querySelector('.blank');
        if (show) { item.classList.add('revealed'); blank.classList.add('show'); blank.textContent = blank.dataset.a; item.querySelector('.hint').textContent = 'Click to hide the answer'; }
        else { item.classList.remove('revealed'); blank.classList.remove('show'); blank.textContent = ph; item.querySelector('.hint').textContent = 'Click to show the answer'; }
    });
}

/* ══════════════════════════════════════════
        TRANSFORM DATA
   ══════════════════════════════════════════ */
const transformData = [
    { orig: 'I work in a school.', pronoun: 'He', ans: 'He works in a school.' },
    { orig: 'I teach maths.', pronoun: 'She', ans: 'She teaches maths.' },
    { orig: 'I study English every day.', pronoun: 'He', ans: 'He studies English every day.' },
    { orig: 'I live in a small flat.', pronoun: 'She', ans: 'She lives in a small flat.' },
    { orig: 'I go to the gym on Mondays.', pronoun: 'He', ans: 'He goes to the gym on Mondays.' },
    { orig: 'I have breakfast at 7 a.m.', pronoun: 'She', ans: 'She has breakfast at 7 a.m.' },
    { orig: 'I watch films at the weekend.', pronoun: 'He', ans: 'He watches films at the weekend.' },
    { orig: 'I finish work at 5 o\'clock.', pronoun: 'She', ans: 'She finishes work at 5 o\'clock.' },
    { orig: 'I play the guitar.', pronoun: 'He', ans: 'He plays the guitar.' },
    { orig: 'I speak Spanish and English.', pronoun: 'She', ans: 'She speaks Spanish and English.' },
    { orig: 'I wash the dishes after dinner.', pronoun: 'He', ans: 'He washes the dishes after dinner.' },
    { orig: 'I carry my laptop to work.', pronoun: 'She', ans: 'She carries her laptop to work.' },
    { orig: 'I eat lunch at 12.', pronoun: 'He', ans: 'He eats lunch at 12.' },
    { orig: 'I try to read before bed.', pronoun: 'She', ans: 'She tries to read before bed.' },
    { orig: 'I fix phones and tablets.', pronoun: 'He', ans: 'He fixes phones and tablets.' },
    { orig: 'I read the news online.', pronoun: 'She', ans: 'She reads the news online.' },
    { orig: 'I miss my family a lot.', pronoun: 'He', ans: 'He misses his family a lot.' },
    { orig: 'I enjoy cooking Italian food.', pronoun: 'She', ans: 'She enjoys cooking Italian food.' },
    { orig: 'I fly to Paris for work.', pronoun: 'He', ans: 'He flies to Paris for work.' },
    { orig: 'I do exercise in the morning.', pronoun: 'She', ans: 'She does exercise in the morning.' },
];

function buildTransform() {
    const c = document.getElementById('transform-container');
    c.innerHTML = '';
    transformData.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'transform-card';
        div.innerHTML = `
            <div class="original"><span class="t-num">${i+1}</span>${item.orig}</div>
            <div class="arrow">↓ Change to <strong>${item.pronoun}</strong></div>
            <div class="answer-line" data-a="${item.ans}">&nbsp;</div>
            <div class="t-hint">Click to show / hide</div>
        `;
        div.addEventListener('click', function(){
            const al = this.querySelector('.answer-line');
            if (this.classList.contains('revealed')) {
                this.classList.remove('revealed'); al.classList.remove('show'); al.innerHTML = '&nbsp;';
                this.querySelector('.t-hint').textContent = 'Click to show the answer';
            } else {
                this.classList.add('revealed'); al.classList.add('show'); al.textContent = al.dataset.a;
                this.querySelector('.t-hint').textContent = 'Click to hide the answer';
            }
        });
        c.appendChild(div);
    });
}
function toggleAllTransform(show) {
    document.querySelectorAll('#transform-container .transform-card').forEach(card => {
        const al = card.querySelector('.answer-line');
        if (show) { card.classList.add('revealed'); al.classList.add('show'); al.textContent = al.dataset.a; card.querySelector('.t-hint').textContent = 'Click to hide the answer'; }
        else { card.classList.remove('revealed'); al.classList.remove('show'); al.innerHTML = '&nbsp;'; card.querySelector('.t-hint').textContent = 'Click to show the answer'; }
    });
}

/* ══════════════════════════════════════════
        PRONUNCIATION DATA
   ══════════════════════════════════════════ */
const pronData = [
    { word: 'works', sound: '/s/', cls: 'pron-s' },
    { word: 'speaks', sound: '/s/', cls: 'pron-s' },
    { word: 'eats', sound: '/s/', cls: 'pron-s' },
    { word: 'gets', sound: '/s/', cls: 'pron-s' },
    { word: 'stops', sound: '/s/', cls: 'pron-s' },
    { word: 'lives', sound: '/z/', cls: 'pron-z' },
    { word: 'plays', sound: '/z/', cls: 'pron-z' },
    { word: 'reads', sound: '/z/', cls: 'pron-z' },
    { word: 'goes', sound: '/z/', cls: 'pron-z' },
    { word: 'has', sound: '/z/', cls: 'pron-z' },
    { word: 'studies', sound: '/z/', cls: 'pron-z' },
    { word: 'teaches', sound: '/ɪz/', cls: 'pron-iz' },
    { word: 'washes', sound: '/ɪz/', cls: 'pron-iz' },
    { word: 'finishes', sound: '/ɪz/', cls: 'pron-iz' },
    { word: 'fixes', sound: '/ɪz/', cls: 'pron-iz' },
    { word: 'misses', sound: '/ɪz/', cls: 'pron-iz' },
];

function buildPron() {
    const c = document.getElementById('pron-container');
    c.innerHTML = '';
    const shuffled = [...pronData].sort(() => Math.random() - 0.5);
    shuffled.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'exercise-item';
        div.innerHTML = `
            <div class="q-text"><span class="q-num">${i+1}</span><strong>${item.word}</strong>
            <span style="margin-left:12px;" class="blank" data-a="${item.sound}" data-cls="${item.cls}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
            <div class="hint">Click to reveal the sound</div>
        `;
        div.addEventListener('click', function(){
            const blank = this.querySelector('.blank');
            if (this.classList.contains('revealed')) {
                this.classList.remove('revealed'); blank.className = 'blank'; blank.innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                this.querySelector('.hint').textContent = 'Click to reveal the sound';
            } else {
                this.classList.add('revealed'); blank.classList.add('show', blank.dataset.cls); blank.textContent = blank.dataset.a;
                this.querySelector('.hint').textContent = 'Click to hide';
            }
        });
        c.appendChild(div);
    });
}
function toggleAllPron(show) {
    document.querySelectorAll('#pron-container .exercise-item').forEach(item => {
        const blank = item.querySelector('.blank');
        if (show) { item.classList.add('revealed'); blank.classList.add('show', blank.dataset.cls); blank.textContent = blank.dataset.a; item.querySelector('.hint').textContent = 'Click to hide'; }
        else { item.classList.remove('revealed'); blank.className = 'blank'; blank.innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; item.querySelector('.hint').textContent = 'Click to reveal the sound'; }
    });
}

/* ══════════════════════════════════════════
        DIALOGUE DATA (14 gaps)
   ══════════════════════════════════════════ */
const dialogueLines = [
    { speaker: 'Emily', parts: ['What do you do, Sofia?'] },
    { speaker: 'Sofia', parts: ["I'm a ", {gap:'nurse'}, ". I work in a ", {gap:'hospital'}, "."] },
    { speaker: 'Emily', parts: ['Do you like your job?'] },
    { speaker: 'Sofia', parts: ['Yes, I do. I like it very much.'] },
    { speaker: 'Emily', parts: ['What does your ', {gap:'husband'}, ' do?'] },
    { speaker: 'Sofia', parts: ["He's a ", {gap:'tourist guide'}, ". He ", {gap:'works'}, " at the Prado ", {gap:'museum'}, "."] },
    { speaker: 'Emily', parts: ['Does he ', {gap:'like'}, ' his job?'] },
    { speaker: 'Sofia', parts: ['Yes, very much. He ', {gap:'speaks'}, ' English and French.'] },
    { speaker: 'Emily', parts: ['Does he speak English at ', {gap:'home'}, '?'] },
    { speaker: 'Sofia', parts: ['No, he ', {gap:"doesn't"}, ". He only speaks English at ", {gap:'work'}, "."] },
    { speaker: 'Emily', parts: ['Where does he ', {gap:'have'}, ' lunch?'] },
    { speaker: 'Sofia', parts: ['He has lunch in a ', {gap:'restaurant'}, ' near the museum.'] },
    { speaker: 'Emily', parts: ['What time does he ', {gap:'finish'}, '?'] },
    { speaker: 'Sofia', parts: ['He finishes at six o\'clock.'] },
];

function buildDialogue() {
    const box = document.getElementById('dialogue-box');
    box.innerHTML = '';
    let gapCount = 0;
    dialogueLines.forEach(line => {
        const div = document.createElement('div');
        div.className = 'dialogue-line';
        let html = `<span class="speaker">${line.speaker}:</span> `;
        line.parts.forEach(part => {
            if (typeof part === 'string') {
                html += part;
            } else {
                gapCount++;
                const ph = '(' + gapCount + ')';
                html += `<span class="gap" data-a="${part.gap}" data-ph="${ph}" onclick="toggleGap(this)">${ph}</span>`;
            }
        });
        div.innerHTML = html;
        box.appendChild(div);
    });
}

function toggleGap(el) {
    el.classList.toggle('show');
    el.textContent = el.classList.contains('show') ? el.dataset.a : el.dataset.ph;
}

function toggleAllGaps(show) {
    document.querySelectorAll('#dialogue-box .gap').forEach(g => {
        if (show) { g.classList.add('show'); g.textContent = g.dataset.a; }
        else { g.classList.remove('show'); g.textContent = g.dataset.ph; }
    });
}

/* ══════════════════════════════════════════
        INIT
   ══════════════════════════════════════════ */
buildPractice();
buildTransform();
buildPron();
buildDialogue();
</script>
</body>
</html>
